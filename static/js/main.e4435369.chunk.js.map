{"version":3,"sources":["components/Intro.tsx","components/FileSelector.tsx","components/MessagePreview.tsx","config/animation.ts","components/Settings.tsx","components/Creator.tsx","components/Modal.tsx","util/useLocalStorage.ts","components/Footer.tsx","App.tsx","index.tsx"],"names":["Intro","className","FileSelector","props","fileInputRef","useRef","type","id","onChange","onFileSelected","current","files","ref","htmlFor","MessagePreview","onReady","onDestroy","previewCanvasRef","useEffect","previewCanvas","previewCanvasCtx","getContext","canvasWidth","width","canvasHeight","height","listener","canvas","sourceWidth","sourceHeight","scale","Math","min","outputWidth","outputHeight","offsetX","offsetY","clearRect","drawImage","role","waveStyles","classic","centered","bounce","blendModes","overlay","lighten","multiply","colours","kakapo","cockatoo","galah","king","hyacinth","defaultSettings","waveStyle","blendMode","verticalCenter","magnitude","colourScheme","contrast","brightness","colourOptions","Settings","waveInputRef","centerInputRef","magnitudeInputRef","blendInputRef","colourInputRef","contrastInputRef","brightnessInputRef","onInputChange","newSettings","value","Number","parseFloat","onSettingsChanged","Object","keys","map","key","max","step","defaultValue","getPixelBounds","image","cropperCanvas","document","createElement","cropperCtx","ctx","x","pixels","getImageData","pixelDataLength","data","length","bounds","top","left","right","bottom","y","i","getPixelBoundsForCanvas","renderFrame","frameNumber","canvasCtx","imageSource","imageSizing","settings","transformationMatrices","frameTransformation","globalCompositeOperation","setTransform","fillStyle","fillRect","renderCachedFrame","cachedFrame","crop","putImageData","Creator","useState","setSettings","Image","imageElement","setImageSource","emojiCanvas","imagePrepCanvas","loaded","imageMeta","setImageMeta","lastRenderIteration","setLastRenderIteration","lastRenderTime","setLastRenderTime","outputImageBlobUrl","setOutputImageBlobUrl","previewRenderListeners","setPreviewRenderListeners","cachedFrameData","setCachedFrameData","outputElementRef","emojiInputRef","addPreviewRenderListener","useMemo","state","removePreviewRenderListener","filter","l","imagePrepCtx","scaleAmount","maxWidth","maxHeight","imageRegionWidth","imageRegionHeight","getImageSizing","preProcessedImageCtx","grayscaleImage","brightnessFactor","contrastFactor","valueAdjusted","prepForRender","cachedData","cachedFrames","maximalBounds","verticalAnchor","getTransformationMatrices","rawData","rawPixels","pixelIndex","push","computedBounds","frames","generateCachedFrames","updateLoopRef","previewWidth","previewHeight","renderIteration","lastUpdatedAt","performance","now","lastLoopedAt","updateLoop","timeDiff","timeSinceLastLoop","elapsedFrames","floor","forEach","window","requestAnimationFrame","cancelAnimationFrame","file","src","URL","createObjectURL","onload","maxLength","event","target","trim","font","fillText","placeholder","onClick","GIF","gifOutputCanvas","outputProcessingCtx","gifRenderer","workers","workerScript","process","transparent","on","blob","addFrame","delay","copy","render","scrollIntoView","alt","Modal","isOpen","aria-modal","children","triggerClose","onClose","makeKey","Footer","href","App","initialValue","item","localStorage","getItem","JSON","parse","error","storedValue","setStoredValue","setItem","stringify","console","log","useLocalStorage","hasSeenModal","setHasSeenModal","isModalOpen","setIsModalOpen","aria-hidden","undefined","rootElement","getElementById"],"mappings":"qNAEe,SAASA,IACvB,OACC,6BAASC,UAAU,SAClB,wBAAIA,UAAU,gBAAd,cAEA,uBAAGA,UAAU,sBAAb,8F,kBCLY,SAASC,EAAaC,GACpC,IAAMC,EAAeC,iBAAyB,MAM9C,OACC,oCACC,2BACCC,KAAK,OACLC,GAAG,aACHN,UAAU,sBACVO,SAVsB,WAAO,IAAD,IAC9BL,EAAMM,eAAN,UAAqBL,EAAaM,eAAlC,iBAAqB,EAAsBC,aAA3C,aAAqB,EAA8B,KAUjDC,IAAKR,IAEN,2BAAOS,QAAQ,aAAaZ,UAAU,8BAAtC,qBCfY,SAASa,EAAT,GAME,IALhBC,EAKe,EALfA,QACAC,EAIe,EAJfA,UAKMC,EAAmBZ,iBAA0B,MAgCnD,OA9BAa,qBAAU,WACT,IAAMC,EAAgBF,EAAiBP,QACjCU,EAAgB,OAAGD,QAAH,IAAGA,OAAH,EAAGA,EAAeE,WAAW,MAEnD,GAAKF,GAAkBC,EAAvB,CAIA,IAAME,EAAcH,EAAcI,MAC5BC,EAAY,OAAGL,QAAH,IAAGA,OAAH,EAAGA,EAAeM,OAE9BC,EAAW,SAACC,EAA2BC,EAAqBC,GACjE,IAAMC,EAAQC,KAAKC,IAAIV,EAAcM,EAAaJ,EAAeK,GAE3DI,EAAcH,EAAQF,EACtBM,EAAeJ,EAAQD,EAEvBM,GAAWb,EAAcW,GAAe,EACxCG,GAAWZ,EAAeU,GAAgB,EAEhDd,EAAiBiB,UAAU,EAAG,EAAGf,EAAaE,GAC9CJ,EAAiBkB,UAAUX,EAAQQ,EAASC,EAASH,EAAaC,IAKnE,OAFAnB,EAAQW,GAED,WACNV,EAAUU,OAET,CAACX,EAASC,IAEZ,4BAAQf,UAAU,kBACjB,0BAAMsC,KAAK,eAAetC,UAAU,2BACpC,uBAAGA,UAAU,wBAAb,6BACA,4BAAQA,UAAU,wBAAwBW,IAAKK,EAAkBM,MAAM,OAAOE,OAAO,UC9CjF,IAAMe,EAAa,CACzBC,QAAS,UACTC,SAAU,WACVC,OAAQ,cAGIC,EAAa,CACzBC,QAAS,UACTC,QAAS,UACTC,SAAU,YAIEC,EAAU,CACtBP,QAAS,CACR,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEDQ,OAAQ,CACP,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEDC,SAAU,CACT,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,WAEDC,MAAO,CAAC,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,WAC3GC,KAAM,CAAC,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,UAAW,WAC1GC,SAAU,CACT,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,YCjDK,IAAMC,EAAkC,CAC9CC,UAAW,UACXC,UAAW,UACXC,eAAgB,EAChBC,UAAW,EACXC,aAAc,UACdC,SAAU,EACVC,WAAY,GAKPC,EAAa,2BDyCoD,CACtErB,QAAS,UACTQ,OAAQ,8BACRC,SAAU,iBACVC,MAAO,aACPE,SAAU,gBACVD,KAAM,sBC/CY,IAElB,KAAoB,SAGN,SAASW,EAAS5D,GAA8E,IAAD,EACvG6D,EAAe3D,iBAA0B,MACzC4D,EAAiB5D,iBAAyB,MAC1C6D,EAAoB7D,iBAAyB,MAC7C8D,EAAgB9D,iBAA0B,MAC1C+D,EAAiB/D,iBAA0B,MAC3CgE,EAAmBhE,iBAAyB,MAC5CiE,EAAqBjE,iBAAyB,MAE9CkE,EAAgB,WAAO,IAAD,4BACrBC,EAA8B,CACnCjB,UAAS,oBAAGS,EAAatD,eAAhB,aAAG,EAAsB+D,aAAzB,QAA8DnB,EAAgBC,UACvFC,UAAS,oBAAGW,EAAczD,eAAjB,aAAG,EAAuB+D,aAA1B,QAA+DnB,EAAgBE,UACxFG,aAAY,oBAAGS,EAAe1D,eAAlB,aAAG,EAAwB+D,aAA3B,QAAkEnB,EAAgBK,aAE9FF,eACkC,OAAjC,UAAAQ,EAAevD,eAAf,eAAwB+D,OACrBC,OAAOC,WAAP,UAAkBV,EAAevD,eAAjC,aAAkB,EAAwB+D,OAC1CnB,EAAgBG,eACpBC,UACqC,OAApC,UAAAQ,EAAkBxD,eAAlB,eAA2B+D,OACxBC,OAAOC,WAAP,UAAkBT,EAAkBxD,eAApC,aAAkB,EAA2B+D,OAC7CnB,EAAgBG,eACpBG,SACoC,OAAnC,UAAAS,EAAiB3D,eAAjB,eAA0B+D,OACvBC,OAAOC,WAAP,UAAkBN,EAAiB3D,eAAnC,aAAkB,EAA0B+D,OAC5CnB,EAAgBM,SACpBC,WACsC,OAArC,UAAAS,EAAmB5D,eAAnB,eAA4B+D,OACzBC,OAAOC,WAAP,UAAkBL,EAAmB5D,eAArC,aAAkB,EAA4B+D,OAC9CnB,EAAgBO,YAGrB1D,EAAMyE,kBAAkBJ,IAGzB,OACC,yBAAKvE,UAAU,uCACd,wBAAIA,UAAU,sBAAd,eACA,2BAAOA,UAAU,kBAAkBY,QAAQ,eAA3C,eAIA,4BAAQZ,UAAU,kBAAkBM,GAAG,cAAcK,IAAKoD,EAAcxD,SAAU+D,GAChFM,OAAOC,KAAKtC,GAAYuC,KAAI,SAACC,GAAD,OAC5B,4BAAQA,IAAKA,EAAKP,MAAOO,GACvBxC,EAAWwC,QAKf,2BAAO/E,UAAU,kBAAkBY,QAAQ,oBAA3C,mBAGA,2BACCZ,UAAU,kBACVM,GAAG,mBACHD,KAAK,QACL0B,IAAI,IACJiD,IAAI,MACJC,KAAK,OACLtE,IAAKsD,EACLiB,aAAc7B,EAAgBI,UAC9BlD,SAAU+D,IAGX,2BAAOtE,UAAU,kBAAkBY,QAAQ,iBAA3C,mBAIA,2BACCZ,UAAU,kBACVM,GAAG,gBACHD,KAAK,QACL0B,IAAI,QACJiD,IAAI,IACJC,KAAK,OACLtE,IAAKqD,EACLkB,aAAc7B,EAAgBG,eAC9BjD,SAAU+D,IAGX,2BAAOtE,UAAU,kBAAkBY,QAAQ,iBAA3C,mBAIA,4BAAQZ,UAAU,kBAAkBM,GAAG,gBAAgBK,IAAKwD,EAAgB5D,SAAU+D,GACpFM,OAAOC,KAAKhB,GAAeiB,KAAI,SAACC,GAAD,OAC/B,4BAAQA,IAAKA,EAAKP,MAAOO,GACvBlB,EAAckB,QAhGW,UAqG5B,UAAAZ,EAAe1D,eAAf,eAAwB+D,QACxB,oCACC,2BAAOxE,UAAU,kBAAkBY,QAAQ,mBAA3C,YAGA,2BACCZ,UAAU,kBACVM,GAAG,kBACHD,KAAK,QACL0B,IAAI,KACJiD,IAAI,IACJC,KAAK,OACLtE,IAAKyD,EACLc,aAAc7B,EAAgBM,SAC9BpD,SAAU+D,IAGX,2BAAOtE,UAAU,kBAAkBY,QAAQ,qBAA3C,cAGA,2BACCZ,UAAU,kBACVM,GAAG,oBACHD,KAAK,QACL0B,IAAI,IACJiD,IAAI,IACJC,KAAK,OACLtE,IAAK0D,EACLa,aAAc7B,EAAgBO,WAC9BrD,SAAU+D,IAGX,2BAAOtE,UAAU,kBAAkBY,QAAQ,gBAA3C,sBAIA,4BAAQZ,UAAU,kBAAkBM,GAAG,eAAeK,IAAKuD,EAAe3D,SAAU+D,GAClFM,OAAOC,KAAKlC,GAAYmC,KAAI,SAACC,GAAD,OAC5B,4BAAQA,IAAKA,EAAKP,MAAOO,GACvBpC,EAAWoC,UC3EpB,SAASI,EAAeC,GACvB,IAAMC,EAAgBC,SAASC,cAAc,UAC7CF,EAAc/D,MAAQ8D,EAAM9D,MAC5B+D,EAAc7D,OAAS4D,EAAM5D,OAE7B,IAAMgE,EAAaH,EAAcjE,WAAW,MAE5C,OAAKoE,GASLA,EAAWnD,UAAU+C,EAAO,EAAG,GA/DhC,SAAiCK,GAkBhC,IAjBA,IAaIC,EAbEpE,EAAQmE,EAAI/D,OAAOJ,MACnBE,EAASiE,EAAI/D,OAAOF,OAEpBmE,EAASF,EAAIG,aAAa,EAAG,EAAGtE,EAAOE,GACvCqE,EAAkBF,EAAOG,KAAKC,OAE9BC,EAAS,CACdC,IAAKzE,EAAS,EACd0E,KAAM5E,EAAQ,EACd6E,MAAO7E,EAAQ,EACf8E,OAAQ5E,EAAS,GAIjB6E,EAAI,EAGIC,EAAI,EAAGA,EAAIT,EAAiBS,GAAK,EACd,IAAvBX,EAAOG,KAAKQ,EAAI,KACnBZ,EAAKY,EAAI,EAAKhF,GACd+E,KAAOC,EAAI,EAAIhF,IAEP0E,EAAOC,MACdD,EAAOC,IAAMI,GAGVX,EAAIM,EAAOE,OACdF,EAAOE,KAAOR,GAGXA,EAAIM,EAAOG,QACdH,EAAOG,MAAQT,GAGZW,EAAIL,EAAOI,SACdJ,EAAOI,OAASC,IAQnB,OAHAL,EAAOI,QAAU,EACjBJ,EAAOG,OAAS,EAETH,EAoBQO,CAAwBf,IAT/B,CACNS,IAAK,EACLC,KAAM,EACNC,MAAOf,EAAM9D,MACb8E,OAAQhB,EAAM5D,QA8IjB,SAASgF,EACRC,EACAC,EACAC,EACAC,EACAC,EACAC,GACE,IAAD,EACKC,EAAmB,UAAGD,EAAuBL,EAAcK,EAAuBf,eAA/D,QAA0E,GACnGW,EAAUM,yBAA2B,cACrCN,EAAUtE,UAAU,EAAG,EAAGwE,EAAYvF,YAAauF,EAAYrF,cAE/DmF,EAAUO,aAAV,MAAAP,EAAS,YAAkBK,IAE3BL,EAAUM,yBAA2B,cACrCN,EAAUrE,UAAUsE,EAAa,EAAG,GAGhCE,EAASnD,gBAAgBX,IAC5B2D,EAAUM,yBAA2BH,EAAStD,UAC9CmD,EAAUQ,UAAYnE,EAAQ8D,EAASnD,cAAsC+C,GAC7EC,EAAUS,SAAS,EAAG,EAAGP,EAAYvF,YAAauF,EAAYrF,eAI/DmF,EAAUM,yBAA2B,iBACrCN,EAAUrE,UAAUsE,EAAa,EAAG,GAGrC,SAASS,EAAkBV,EAAqCW,EAAwBC,GACvFZ,EAAUa,aAAaF,GAAcC,EAAKpB,MAAOoB,EAAKrB,KAGxC,SAASuB,IAAwB,IAAD,EACdC,mBAAQ,eACpCpE,IAF0C,mBACvCwD,EADuC,KAC7Ba,EAD6B,OAKvBD,mBAA2B,IAAIE,OAA/CC,EALuC,sBAMRH,mBAAsD,MAN9C,mBAMvCd,EANuC,KAM1BkB,EAN0B,OAOxBJ,oBAA4B,WACjD,IAAM/F,EAAS4D,SAASC,cAAc,UAItC,OAHA7D,EAAOJ,MAAQ,IACfI,EAAOF,OAAS,IAETE,KALDoG,EAPuC,sBAcpBL,mBAA4BnC,SAASC,cAAc,WAAtEwC,EAduC,sBAeZN,mBAAoB,CAAEO,QAAQ,EAAO1G,MAAO,EAAGE,OAAQ,IAf3C,mBAevCyG,EAfuC,KAe5BC,EAf4B,OAgBQT,mBAAS,GAhBjB,mBAgBvCU,EAhBuC,KAgBlBC,EAhBkB,OAiBFX,mBAAS,GAjBP,mBAiBvCY,EAjBuC,KAiBvBC,EAjBuB,OAkBMb,mBAAwB,MAlB9B,mBAkBvCc,EAlBuC,KAkBnBC,EAlBmB,OAmBcf,mBAAkC,IAnBhD,mBAmBvCgB,EAnBuC,KAmBfC,EAnBe,OAoBAjB,qBApBA,mBAoBvCkB,EApBuC,KAoBtBC,EApBsB,KAsBxC5H,EAAmBZ,iBAA0B,MAC7CyI,EAAmBzI,iBAAuB,MAC1C0I,EAAgB1I,iBAAyB,MAiDzC2I,EAA2BC,mBAAQ,WACxC,OAAO,SAACvH,GACPiH,GAA0B,SAACO,GAC1B,MAAM,GAAN,mBAAWA,GAAX,CAAkBxH,UAGlB,IAEGyH,GAA8BF,mBAAQ,WAC3C,OAAO,SAACvH,GACPiH,GAA0B,SAACO,GAC1B,OAAOA,EAAME,QAAO,SAACC,GAAD,OAAOA,IAAM3H,WAGjC,IAEHR,qBAAU,WACT,IAAMoI,EAAetB,EAAgB3G,WAAW,MAE1CF,EAAgBF,EAAiBP,QACjCU,EAAgB,OAAGD,QAAH,IAAGA,OAAH,EAAGA,EAAeE,WAAW,MAEnD,GAAKuF,GAAgB0C,GAAiBnI,GAAkBC,EAAxD,CAIA,IAAMyF,EArQR,SAAwBqB,GACvB,IAAM3G,EAAQ2G,EAAU3G,MAClBE,EAASyG,EAAUzG,OAEnB8H,EAAcxH,KAAKC,IAAI,EA/Gb,IA+G2BT,EA/G3B,IA+G8CE,GAK9D,MAAO,CACNH,YAAakI,IACbhI,aAAciI,IACdC,iBANwBnI,EAAQgI,EAOhCI,kBANyBlI,EAAS8H,GA8PdK,CAAe1B,GAE7B5G,EAAcuF,EAAYvF,YAC1BE,EAAeqF,EAAYrF,aAEjCwG,EAAgBzG,MAAQD,EACxB0G,EAAgBvG,OAASD,EApP3B,SACCqF,EACAgD,EACAxE,EACAyB,GAcA,GAZA+C,EAAqBvH,UACpB+C,EACA,EACA,EACAA,EAAM9D,MACN8D,EAAM5D,QACLoF,EAAYvF,YAAcuF,EAAY6C,kBAAoB,GAC1D7C,EAAYrF,aAAeqF,EAAY8C,mBAAqB,EAC7D9C,EAAY6C,iBACZ7C,EAAY8C,mBDhIkB,SCmI3B7C,EAASnD,aAAmC,CAS/C,IAPA,IAAMmG,EAAiBD,EAAqBhE,aAAa,EAAG,EAAGgB,EAAYvF,YAAauF,EAAYrF,cAC9FoE,EAASkE,EAAe/D,KAExBgE,EAAmBjD,EAASjD,WAC5BD,EAA+B,IAApBkD,EAASlD,SACpBoG,GAAkB,IAAMpG,IAAa,IAAMA,GAExC2C,EAAI,EAAGA,EAAIX,EAAOI,OAAQO,GAAK,EAAG,CAC1C,IACM0D,EAAgBF,GAAoBC,GADX,KAAZpE,EAAOW,GAA6B,KAAhBX,EAAOW,EAAI,GAA6B,KAAhBX,EAAOW,EAAI,GACD,KAAO,KAEhFX,EAAOW,GAAK0D,EACZrE,EAAOW,EAAI,GAAK0D,EAChBrE,EAAOW,EAAI,GAAK0D,EAGjBJ,EAAqBrC,aAAasC,EAAgB,EAAG,IAkNrDI,CAAcrD,EAAayC,EAAc1C,EAAaE,GACtD,IAAMqD,EA5MR,SACCrD,EACAD,EACAxB,GAEA,IAAM1D,EAAS4D,SAASC,cAAc,UAChCE,EAAM/D,EAAON,WAAW,MAE9B,IAAKqE,EACJ,OAAO,KAGR,IAAM0E,EAAe,GAErBzI,EAAOJ,MAAQsF,EAAYvF,YAC3BK,EAAOF,OAASoF,EAAYrF,aAe5B,IAbA,IAAM6I,EAAgB,CACrBnE,IAAKvE,EAAOF,OACZ0E,KAAMxE,EAAOJ,MACb6E,MAAO,EACPC,OAAQ,GAGHU,EF5HA,SACNxD,EAEA+G,EACA5G,GAEA,OAAQH,GAEP,IAAK,WACJ,MAAO,CACN,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAChB,CAAC,EAAG,EAAG,KAAQG,EAAW,GAAK,EAAI,MAASA,GAAY,OAASA,EAAW,KAAO4G,EAAiB5G,GACpG,CAAC,EAAG,EAAG,KAAQA,EAAW,GAAK,EAAI,KAAQA,GAAY,MAAQA,EAAW,OAAS4G,EAAiB5G,GACpG,CAAC,EAAG,EAAG,KAAQA,EAAW,EAAI,IAAaA,GAAY,MAAQA,EAAW,KAAO4G,EAAiB5G,GAClG,CAAC,EAAG,EAAG,KAAQA,EAAW,GAAK,EAAI,MAASA,GAAY,MAAQA,EAAW,MAAQ4G,EAAiB5G,GACpG,CAAC,EAAG,EAAG,EAAG,GAAK,EAAI,KAAQA,EAAW,EAAG,GAAK4G,EAAiB5G,GAC/D,CAAC,EAAG,GAAI,KAAQA,EAAW,GAAK,EAAI,MAASA,EAAW,MAAQA,EAAW,MAAQ4G,EAAiB5G,GACpG,CAAC,EAAG,GAAI,KAAQA,EAAW,EAAI,IAAaA,EAAW,MAAQA,EAAW,KAAO4G,EAAiB5G,GAClG,CAAC,EAAG,GAAI,KAAQA,EAAW,GAAK,EAAI,KAAQA,EAAW,MAAQA,EAAW,OAAS4G,EAAiB5G,GACpG,CAAC,EAAG,GAAI,KAAQA,EAAW,GAAK,EAAI,MAASA,EAAW,OAASA,EAAW,KAAO4G,EAAiB5G,IAEtG,IAAK,SACJ,MAAO,CACN,CACC,GAAK,EAAI,MAASA,EAClB,EACA,EACA,GAAK,EAAI,MAAQA,EACjB,KAAOA,GACN,MAAQ4G,EAAiB5G,GAE3B,CACC,GAAK,EAAI,MAASA,EAClB,EACA,EACA,GAAK,EAAI,MAAQA,EACjB,KAAOA,GACN,MAAQ4G,EAAiB5G,GAE3B,CACC,GAAK,EAAI,KAAQA,EACjB,EACA,EACA,GAAK,EAAI,OAASA,EAClB,KAAOA,GACN,MAAQ4G,EAAiB5G,GAE3B,CACC,IAAI,KAAcA,EAClB,EACA,EACA,EAAI,IAAaA,GAChB,MAAQA,EACT,KAAO4G,EAAiB5G,GAEzB,CACC,GAAK,EAAI,OAASA,EAClB,EACA,EACA,GAAK,EAAI,MAASA,GACjB,MAAQA,EACT,KAAO4G,EAAiB5G,GAEzB,CACC,GAAK,EAAI,MAAQA,EACjB,EACA,EACA,GAAK,EAAI,KAAQA,GAChB,MAAQA,EACT,MAAQ4G,EAAiB5G,GAE1B,CACC,GAAK,EAAI,OAASA,EAClB,EACA,EACA,GAAK,EAAI,KAAQA,GAChB,KAAOA,EACR,MAAQ4G,EAAiB5G,GAE1B,CACC,GAAK,EAAI,MAAQA,EACjB,EACA,EACA,GAAK,EAAI,MAAQA,GAChB,KAAOA,GACP,KAAO4G,EAAiB5G,GAE1B,CACC,GAAK,EAAI,MAASA,EAClB,EACA,EACA,GAAK,EAAI,MAAQA,EACjB,KAAOA,GACN,MAAQ4G,EAAiB5G,GAE3B,CACC,GAAK,EAAI,KAAQA,EACjB,EACA,EACA,GAAK,EAAI,MAAQA,EACjB,KAAOA,GACN,MAAQ4G,EAAiB5G,IAG7B,IAAK,UACJ,MAAO,CACN,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAChB,CACC,GAAK,EAAI,QAAWA,EACpB,EACA,OAAUA,EACV,GAAK,EAAI,QAAWA,GACnB,QAAUA,EACX,MAAQ4G,EAAiB5G,GAE1B,CACC,GAAK,EAAI,SAAWA,EACpB,EACA,MAASA,EACT,GAAK,EAAI,OAAUA,GAClB,SAAWA,EACZ,OAAS4G,EAAiB5G,GAE3B,CACC,EAAI,EAAYA,EAChB,EACA,OAAUA,EACV,GAAK,EAAI,QAAWA,GACnB,SAAWA,EACZ,MAAQ4G,EAAiB5G,GAE1B,CACC,GAAK,EAAI,QAAWA,EACpB,EACA,OAAUA,EACV,GAAK,EAAI,QAAWA,GACnB,SAAWA,EACZ,KAAO4G,EAAiB5G,GAEzB,CACC,EAAI,OAAgBA,EACpB,EACA,OAAUA,EACV,GAAK,EAAI,MAASA,EAClB,QAAUA,EACV,MAAQ4G,EAAiB5G,GAE1B,CACC,GAAK,EAAI,OAAUA,EACnB,GACC,OAAUA,EACX,EAAI,OAAgBA,EACpB,SAAWA,EACX,MAAQ4G,EAAiB5G,GAE1B,CACC,GAAK,EAAI,SAAWA,EACpB,GACC,MAASA,EACV,EAAI,OAAgBA,EACpB,SAAWA,EACX,MAAQ4G,EAAiB5G,GAE1B,CACC,GAAK,EAAI,SAAWA,EACpB,GACC,OAAUA,EACX,EAAI,MAAeA,EACnB,SAAWA,EACX,MAAQ4G,EAAiB5G,GAE1B,CACC,GAAK,EAAI,OAAUA,EACnB,GACC,MAASA,EACV,GAAK,EAAI,QAAWA,EACpB,SAAWA,EACX,MAAQ4G,EAAiB5G,IAK7B,MAAO,GE1DwB6G,CAC9BzD,EAASvD,UACTuD,EAASrD,eACTqD,EAASpD,WAGD6C,EAAI,EAAGA,EFtIS,GEsIOA,IAAK,CACpCE,EAAYF,EAAGb,EAAKL,EAAOwB,EAAaC,EAAUC,GAMlD,IALA,IAAMyD,EAAU9E,EAAIG,aAAa,EAAG,EAAGgB,EAAYvF,YAAauF,EAAYrF,cACtEiJ,EAAYD,EAAQzE,KAIjB2E,EAAa,EAAGA,EAAaD,EAAUzE,OAAQ0E,GAAc,EAE1C,IAA1BD,EAAUC,IACoB,IAA9BD,EAAUC,EAAa,IACO,IAA9BD,EAAUC,EAAa,IACO,IAA9BD,EAAUC,EAAa,KAEvBD,EAAUC,GAAc,EACxBD,EAAUC,EAAa,GAAK,EAC5BD,EAAUC,EAAa,GAAK,GAI9BN,EAAaO,KAAKH,GAElB,IAAMI,EAAiBxF,EAAezD,GAEtC0I,EAAcnE,IAAMnE,KAAKC,IAAI4I,EAAe1E,IAAKmE,EAAcnE,KAC/DmE,EAAclE,KAAOpE,KAAKC,IAAI4I,EAAezE,KAAMkE,EAAclE,MACjEkE,EAAcjE,MAAQrE,KAAKkD,IAAI2F,EAAexE,MAAOiE,EAAcjE,OACnEiE,EAAchE,OAAStE,KAAKkD,IAAI2F,EAAevE,OAAQgE,EAAchE,QAGtE,MAAO,CAAEwE,OAAQT,EAAc7C,KAAM8C,GAgJjBS,CAAqBhE,EAAUD,EAAamB,GAG/D,GAFAa,EAAmBsB,GAEdA,EAAL,CAIA,IAGIY,EAHEC,EAAgB7J,EAAcI,MAAQ4I,EAAW5C,KAAKnB,MAAQ+D,EAAW5C,KAAKpB,KAC9E8E,EAAiB9J,EAAcM,OAAS0I,EAAW5C,KAAKlB,OAAS8D,EAAW5C,KAAKrB,IAGnFgF,EAAkB9C,EAClB+C,EAAgB7C,GAAkB8C,YAAYC,MAC9CC,EAAeH,EA0BnB,OAxBmB,SAAbI,IACL,IAAMF,EAAMD,YAAYC,MAClBG,EAAWH,EAAMF,EACjBM,EAAoBJ,EAAMC,EAG1BI,EAAgB3J,KAAK4J,OAAOH,EAAWC,EAAoB,GA5Y9C,IA6YnBP,GAAmBA,EAAkBQ,GF1Ud,GE2UvBJ,EAAeD,EAEXK,EAAgB,IACnBP,EAAgBE,EAChBhE,EAAkBjG,EAAkB+I,EAAWU,OAAOK,GAAkBf,EAAW5C,MAEnFmB,EAAuBkD,SAAQ,SAAClK,GAC/BA,EAASP,EAAe6J,EAAcC,OAIxCF,EAAgBc,OAAOC,sBAAsBP,GAG9CA,GAEO,WACFR,IACHc,OAAOE,qBAAqBhB,GAI5B1C,EAAuB6C,GACvB3C,EAAkB4C,SAGlB,CAACvE,EAAasB,EAAWpB,IAuC5B,OACC,6BAAS7G,UAAU,WAClB,kBAACC,EAAD,CAAcO,eA5KO,SAACuL,GACvBnE,EAAaoE,IAAMC,IAAIC,gBAAgBH,GAEnCjD,EAAcrI,UACjBqI,EAAcrI,QAAQ+D,MAAQ,IAG/BoD,EAAauE,OAAS,WACrBjE,EAAa,CACZF,QAAQ,EACR1G,MAAOsG,EAAatG,MACpBE,OAAQoG,EAAapG,SAGtBqG,EAAeD,IAIhBY,EAAsB,SA4JrB,yBAAKxI,UAAU,cACd,2BAAOY,QAAQ,cAAcZ,UAAU,qBAAvC,oBACkB,0BAAMA,UAAU,yBAAhB,4BAElB,2BACCA,UAAU,oBACVM,GAAG,cACHD,KAAK,OACL+L,UAAW,EACX7L,SAlKkB,SAAC8L,GACtB,IAAM5G,EAAMqC,EAAY1G,WAAW,MAC7BoD,EAAS6H,EAAMC,OAA4B9H,OAE5CiB,GAAOjB,EAAM+H,OAAOxG,QAAU,IAInCN,EAAIrD,UAAU,EAAG,EAAG0F,EAAYxG,MAAOwG,EAAYtG,QACnDiE,EAAI+G,KAAO,wBACX/G,EAAIgH,SAASjI,EAAOsD,EAAYxG,MAAQ,EAAGwG,EAAYtG,OAAS,GAEhE0G,EAAa,CACZF,QAAQ,EACR1G,MAAOwG,EAAYxG,MACnBE,OAAQsG,EAAYtG,SAGrBqG,EAAeC,GAGfU,EAAsB,QA8InBkE,YAAY,kBAId,yBAAK1M,UAAU,qBACd,kBAAC8D,EAAD,CAAUa,kBAAmB+C,IAC7B,yBAAK1H,UAAU,mFACd,yBAAKA,UAAU,uBACd,4BAAQW,IAAKK,KAGd,kBAACH,EAAD,CAAgBC,QAASiI,EAA0BhI,UAAWmI,OAIhE,4BAAQ7I,KAAK,SAASL,UAAU,SAAS2M,QAlEvB,WAAO,IAAD,EACzB,GAAKhE,GAAoBiD,OAAOgB,IAAhC,CAIA,IAAMC,EAAkBvH,SAASC,cAAc,UAEzCjE,EAASuL,EAAgBvL,MAAQqH,EAAgBrB,KAAKnB,MAAQwC,EAAgBrB,KAAKpB,KACnF1E,EAAUqL,EAAgBrL,OAASmH,EAAgBrB,KAAKlB,OAASuC,EAAgBrB,KAAKrB,IAEtF6G,EAAsBD,EAAgBzL,WAAW,MACvD,GAAK0L,EAAL,CAIA,IAAMC,EAAc,IAAInB,OAAOgB,IAAI,CAClCI,QAAS,EACTC,aAAa,GAAD,OAAKC,aAAL,+BACZ5L,QACAE,SACA2L,YAAa,IAGdJ,EAAYK,GAAG,YAAY,SAACC,GAC3B7E,EAAsByD,IAAIC,gBAAgBmB,OAG3C,IAAK,IAAI5G,EAAc,EAAGA,EFlYF,GEkY4BA,IACnDW,EAAkB0F,EAAqBnE,EAAgBiC,OAAOnE,GAAckC,EAAgBrB,MAC5FyF,EAAYO,SAASR,EAAqB,CAAES,MAAO,GAAIC,MAAM,IAG9DT,EAAYU,SAEZ,UAAA5E,EAAiBpI,eAAjB,SAA0BiN,qBAgCzB,gBAIA,yBAAK1N,UAAU,SAASW,IAAKkI,GAC3BN,GACA,oCACC,mHACA,yBAAKvI,UAAU,gBAAgB2N,IAAI,GAAG3B,IAAKzD,IAC3C,sK,WCjfS,SAASqF,EAAM1N,GAC7B,OAAKA,EAAM2N,OAKV,kBAAC,IAAD,KACC,yBAAK7N,UAAU,qBACd,yBAAKA,UAAU,QAAQsC,KAAK,SAASwL,aAAW,QAC9C5N,EAAM6N,SAAS,CAAEC,aAAc9N,EAAM+N,aAPlC,KCZT,SAASC,EAAQnJ,GAChB,MAAM,WAAN,OAAkBA,GCFJ,SAASoJ,IACvB,OACC,4BAAQnO,UAAU,UACjB,uBAAGA,UAAU,qBAAb,mKAEmD,IAClD,uBAAGoO,KAAK,qCAAR,6BAED,uBAAGpO,UAAU,qBAAb,aACW,yBAAKgM,IAAG,UAAKkB,aAAL,cAAyCS,IAAI,OAAO3N,UAAU,iBADjF,MACsG,IACrG,uBAAGoO,KAAK,mCAAR,gBAED,uBAAGpO,UAAU,qBACZ,uBAAGoO,KAAK,2CAAR,sBCNW,SAASC,IAAoB,IAAD,EFFpC,SAA4BtJ,EAAauJ,GAA2C,IAAD,EACnD7G,oBAAY,WACjD,IACC,IAAM8G,EAAO3C,OAAO4C,aAAaC,QAAQP,EAAQnJ,IAEjD,OAAOwJ,EAAOG,KAAKC,MAAMJ,GAAQD,EAChC,MAAOM,GACR,OAAON,MAPgF,mBAClFO,EADkF,KACrEC,EADqE,KAoBzF,MAAO,CAACD,EATS,SAACrK,GACjB,IACCsK,EAAetK,GACfoH,OAAO4C,aAAaO,QAAQb,EAAQnJ,GAAM2J,KAAKM,UAAUxK,IACxD,MAAOoK,GACRK,QAAQC,IAAIN,MEb0BO,CAAyB,gBAAgB,GADvC,mBACnCC,EADmC,KACrBC,EADqB,OAEJ5H,oBAAmB2H,GAFf,mBAEnCE,EAFmC,KAEtBC,EAFsB,KAS1C,OACC,oCACC,0BACCC,cAAaF,EAAc,YAASG,EACpCzP,UAAS,oBAAesP,EAAc,uBAAyB,KAE/D,kBAACvP,EAAD,MAEA,kBAACyH,EAAD,MAEA,kBAAC2G,EAAD,OAGD,kBAACP,EAAD,CAAOK,QAlBgB,WACxBsB,GAAe,GACfF,GAAgB,IAgBmBxB,OAAQyB,IACxC,gBAAGtB,EAAH,EAAGA,aAAH,OACA,oCACC,uBAAGhO,UAAU,eAAb,+DACA,4BAAQA,UAAU,2BAA2BK,KAAK,SAASsM,QAASqB,GAApE,sBC7BN,IAAM0B,EAAcpK,SAASqK,eAAe,gBAC5ClC,iBAAO,gBAACY,EAAD,MAASqB,K","file":"static/js/main.e4435369.chunk.js","sourcesContent":["import React from 'react';\n\nexport default function Intro(): JSX.Element {\n\treturn (\n\t\t<section className='Intro'>\n\t\t\t<h1 className='Intro__Title'>Party-ify:</h1>\n\n\t\t\t<p className='Intro__Description'>\n\t\t\t\tInstantly* bring the party to any* image. Guaranteed* to make you boring work Slack* fun.\n\t\t\t</p>\n\t\t</section>\n\t);\n}\n","import React, { useRef } from 'react';\n\nexport default function FileSelector(props: { onFileSelected: (fileUrl: File | undefined) => void }): JSX.Element {\n\tconst fileInputRef = useRef<HTMLInputElement>(null);\n\n\tconst handleFileChange = () => {\n\t\tprops.onFileSelected(fileInputRef.current?.files?.[0]);\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<input\n\t\t\t\ttype='file'\n\t\t\t\tid='file-input'\n\t\t\t\tclassName='FileSelector__Input'\n\t\t\t\tonChange={handleFileChange}\n\t\t\t\tref={fileInputRef}\n\t\t\t/>\n\t\t\t<label htmlFor='file-input' className='Button FileSelector__Label'>\n\t\t\t\tPick an image...\n\t\t\t</label>\n\t\t</>\n\t);\n}\n","import React, { useEffect, useRef } from 'react';\nimport { PreviewRenderListener } from './Creator';\n\nexport default function MessagePreview({\n\tonReady,\n\tonDestroy,\n}: {\n\tonReady: (listener: PreviewRenderListener) => void;\n\tonDestroy: (listener: PreviewRenderListener) => void;\n}): JSX.Element {\n\tconst previewCanvasRef = useRef<HTMLCanvasElement>(null);\n\n\tuseEffect(() => {\n\t\tconst previewCanvas = previewCanvasRef.current;\n\t\tconst previewCanvasCtx = previewCanvas?.getContext('2d');\n\n\t\tif (!previewCanvas || !previewCanvasCtx) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst canvasWidth = previewCanvas.width;\n\t\tconst canvasHeight = previewCanvas?.height;\n\n\t\tconst listener = (canvas: HTMLCanvasElement, sourceWidth: number, sourceHeight: number) => {\n\t\t\tconst scale = Math.min(canvasWidth / sourceWidth, canvasHeight / sourceHeight);\n\n\t\t\tconst outputWidth = scale * sourceWidth;\n\t\t\tconst outputHeight = scale * sourceHeight;\n\n\t\t\tconst offsetX = (canvasWidth - outputWidth) / 2;\n\t\t\tconst offsetY = (canvasHeight - outputHeight) / 2;\n\n\t\t\tpreviewCanvasCtx.clearRect(0, 0, canvasWidth, canvasHeight);\n\t\t\tpreviewCanvasCtx.drawImage(canvas, offsetX, offsetY, outputWidth, outputHeight);\n\t\t};\n\n\t\tonReady(listener);\n\n\t\treturn () => {\n\t\t\tonDestroy(listener);\n\t\t};\n\t}, [onReady, onDestroy]);\n\treturn (\n\t\t<figure className='MessagePreview'>\n\t\t\t<span role='presentation' className='MessagePreview__Avatar' />\n\t\t\t<p className='MessagePreview__Text'>@channel it&apos;s party time!</p>\n\t\t\t<canvas className='MessagePreview__Emoji' ref={previewCanvasRef} width='22px' height='22px' />\n\t\t</figure>\n\t);\n}\n","export const waveStyles = {\n\tclassic: 'Classic',\n\tcentered: 'Centered',\n\tbounce: 'Bounce/bop',\n};\n\nexport const blendModes = {\n\toverlay: 'Overlay',\n\tlighten: 'Lighten',\n\tmultiply: 'Multiply',\n};\n\n// Colours for the background. There's so few it's not worth trying to do any clever generation\nexport const colours = {\n\tclassic: [\n\t\t'#ff6968',\n\t\t'#fe6cb7',\n\t\t'#ff68f7',\n\t\t'#ff8cff',\n\t\t'#d78cff',\n\t\t'#8bb5fe',\n\t\t'#87ffff',\n\t\t'#88ff89',\n\t\t'#fed689',\n\t\t'#ff8d8b',\n\t],\n\tkakapo: [\n\t\t'#53752e',\n\t\t'#678d31',\n\t\t'#74a145',\n\t\t'#94d64d',\n\t\t'#97e346',\n\t\t'#aaf757',\n\t\t'#93d64b',\n\t\t'#91bd62',\n\t\t'#84b352',\n\t\t'#48820a',\n\t],\n\tcockatoo: [\n\t\t'#ffffff',\n\t\t'#ffffff',\n\t\t'#ffffff',\n\t\t'#ffffff',\n\t\t'#ffffff',\n\t\t'#ffffff',\n\t\t'#ffffff',\n\t\t'#ffffff',\n\t\t'#ffffff',\n\t\t'#ffffff',\n\t],\n\tgalah: ['#ff79f8', '#ff57cb', '#ff329a', '#ff0968', '#f60088', '#fa31ff', '#f72fa7', '#f34bc6', '#f48dff', '#f2a2ff'],\n\tking: ['#549310', '#6bab12', '#f2be03', '#fc9e41', '#f57118', '#d17205', '#fa8d2d', '#ed881c', '#e5cf24', '#9aae04'],\n\thyacinth: [\n\t\t'#46f6ff',\n\t\t'#007efe',\n\t\t'#009fff',\n\t\t'#0029c9',\n\t\t'#3b4ee4',\n\t\t'#5e72ff',\n\t\t'#0095ff',\n\t\t'#00b2ff',\n\t\t'#00ccff',\n\t\t'#00e2ff',\n\t],\n};\n\nexport const colourLabels: { [key in keyof typeof colours]: string } = {\n\tclassic: 'Classic',\n\tkakapo: 'Kākāpō green',\n\tcockatoo: 'Cockatoo white',\n\tgalah: 'Galah pink',\n\thyacinth: 'Hyacinth blue',\n\tking: 'King green+orange',\n};\n\nexport const frameCount = 10; // This could be made more flexible with some LCM math to allow for different frame counts\n\n// Again, hardcoding because it's easier than figuring out a formula for the animation path\n// The transformations are based on a canvas size of 200x200px, which is Not Great™, but sufficient for what this is (a hack)\nexport function getTransformationMatrices(\n\twaveStyle: keyof typeof waveStyles,\n\t// imageSizing: ImageSizing,\n\tverticalAnchor: number,\n\tmagnitude: number\n): number[][] {\n\tswitch (waveStyle) {\n\t\t// The 1 - (1 - x) format is a bit weird, but makes it tweak the base value (x), rather than having to mentally do subtraction\n\t\tcase 'centered':\n\t\t\treturn [\n\t\t\t\t[1, 0, 0, 1, 0, 0],\n\t\t\t\t[1, 0, 0.223 * magnitude, 1 - (1 - 0.944) * magnitude, -33.375 * magnitude, 8.43 * verticalAnchor * magnitude],\n\t\t\t\t[1, 0, 0.326 * magnitude, 1 - (1 - 0.84) * magnitude, -48.94 * magnitude, 23.813 * verticalAnchor * magnitude],\n\t\t\t\t[1, 0, 0.315 * magnitude, 1 - (1 - 0.75) * magnitude, -47.25 * magnitude, 37.3 * verticalAnchor * magnitude],\n\t\t\t\t[1, 0, 0.236 * magnitude, 1 - (1 - 0.685) * magnitude, -35.44 * magnitude, 47.25 * verticalAnchor * magnitude],\n\t\t\t\t[1, 0, 0, 1 - (1 - 0.66) * magnitude, 0, 50 * verticalAnchor * magnitude],\n\t\t\t\t[1, 0, -0.236 * magnitude, 1 - (1 - 0.685) * magnitude, 35.44 * magnitude, 47.25 * verticalAnchor * magnitude],\n\t\t\t\t[1, 0, -0.315 * magnitude, 1 - (1 - 0.75) * magnitude, 47.25 * magnitude, 37.3 * verticalAnchor * magnitude],\n\t\t\t\t[1, 0, -0.326 * magnitude, 1 - (1 - 0.84) * magnitude, 48.94 * magnitude, 23.813 * verticalAnchor * magnitude],\n\t\t\t\t[1, 0, -0.223 * magnitude, 1 - (1 - 0.944) * magnitude, 33.375 * magnitude, 8.43 * verticalAnchor * magnitude],\n\t\t\t];\n\t\tcase 'bounce':\n\t\t\treturn [\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 0.945) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\t1 - (1 - 1.18) * magnitude,\n\t\t\t\t\t5.48 * magnitude,\n\t\t\t\t\t-43.57 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 0.945) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\t1 - (1 - 1.17) * magnitude,\n\t\t\t\t\t4.48 * magnitude,\n\t\t\t\t\t-37.37 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 0.98) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\t1 - (1 - 1.067) * magnitude,\n\t\t\t\t\t1.99 * magnitude,\n\t\t\t\t\t-14.68 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 1.125) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\t1 - (1 - 0.86) * magnitude,\n\t\t\t\t\t-12.46 * magnitude,\n\t\t\t\t\t20.2 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 1.215) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\t1 - (1 - 0.785) * magnitude,\n\t\t\t\t\t-21.43 * magnitude,\n\t\t\t\t\t32.1 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 1.15) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\t1 - (1 - 0.82) * magnitude,\n\t\t\t\t\t-15.28 * magnitude,\n\t\t\t\t\t27.71 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 1.097) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\t1 - (1 - 0.92) * magnitude,\n\t\t\t\t\t-9.63 * magnitude,\n\t\t\t\t\t12.52 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 1.03) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\t1 - (1 - 1.03) * magnitude,\n\t\t\t\t\t-2.99 * magnitude,\n\t\t\t\t\t-5.46 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 0.975) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\t1 - (1 - 1.12) * magnitude,\n\t\t\t\t\t2.49 * magnitude,\n\t\t\t\t\t-25.45 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 0.95) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t0,\n\t\t\t\t\t1 - (1 - 1.19) * magnitude,\n\t\t\t\t\t5.32 * magnitude,\n\t\t\t\t\t-43.67 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t];\n\t\tcase 'classic':\n\t\t\treturn [\n\t\t\t\t[1, 0, 0, 1, 0, 0],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 0.99375) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t0.16679 * magnitude,\n\t\t\t\t\t1 - (1 - 0.95027) * magnitude,\n\t\t\t\t\t-30.3727 * magnitude,\n\t\t\t\t\t7.245 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 1.04125) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t0.2315 * magnitude,\n\t\t\t\t\t1 - (1 - 0.8621) * magnitude,\n\t\t\t\t\t-50.84534 * magnitude,\n\t\t\t\t\t20.088 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 1.0) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t0.28054 * magnitude,\n\t\t\t\t\t1 - (1 - 0.82325) * magnitude,\n\t\t\t\t\t-51.28815 * magnitude,\n\t\t\t\t\t25.97 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 0.94375) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t0.11371 * magnitude,\n\t\t\t\t\t1 - (1 - 0.80963) * magnitude,\n\t\t\t\t\t-27.00883 * magnitude,\n\t\t\t\t\t27.8 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 0.91125) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t0.04853 * magnitude,\n\t\t\t\t\t1 - (1 - 0.766) * magnitude,\n\t\t\t\t\t9.24426 * magnitude,\n\t\t\t\t\t34.19 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 0.9825) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t-0.17287 * magnitude,\n\t\t\t\t\t1 - (1 - 0.70702) * magnitude,\n\t\t\t\t\t25.55122 * magnitude,\n\t\t\t\t\t42.85 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 1.02125) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t-0.2405 * magnitude,\n\t\t\t\t\t1 - (1 - 0.77915) * magnitude,\n\t\t\t\t\t34.20272 * magnitude,\n\t\t\t\t\t32.26 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 1.02375) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t-0.28875 * magnitude,\n\t\t\t\t\t1 - (1 - 0.8225) * magnitude,\n\t\t\t\t\t46.15469 * magnitude,\n\t\t\t\t\t26.16 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t\t[\n\t\t\t\t\t1 - (1 - 0.9975) * magnitude,\n\t\t\t\t\t0,\n\t\t\t\t\t-0.1975 * magnitude,\n\t\t\t\t\t1 - (1 - 0.91375) * magnitude,\n\t\t\t\t\t30.20937 * magnitude,\n\t\t\t\t\t12.71 * verticalAnchor * magnitude,\n\t\t\t\t],\n\t\t\t];\n\t}\n\n\treturn [];\n}\n","import React, { useRef } from 'react';\nimport { waveStyles, blendModes, colourLabels } from '../config/animation';\n\nexport interface SettingsValues {\n\twaveStyle: keyof typeof waveStyles;\n\tblendMode: keyof typeof blendModes;\n\tverticalCenter: number;\n\tmagnitude: number;\n\tcolourScheme: keyof typeof colourOptions;\n\tcontrast: number;\n\tbrightness: number;\n}\n\nexport const defaultSettings: SettingsValues = {\n\twaveStyle: 'classic',\n\tblendMode: 'overlay',\n\tverticalCenter: 1,\n\tmagnitude: 1,\n\tcolourScheme: 'classic',\n\tcontrast: 0,\n\tbrightness: 1,\n};\n\nexport const NONE_COLOUR_NAME = 'none';\n\nconst colourOptions = {\n\t...colourLabels,\n\t[NONE_COLOUR_NAME]: 'None',\n};\n\nexport default function Settings(props: { onSettingsChanged: (values: SettingsValues) => void }): JSX.Element {\n\tconst waveInputRef = useRef<HTMLSelectElement>(null);\n\tconst centerInputRef = useRef<HTMLInputElement>(null);\n\tconst magnitudeInputRef = useRef<HTMLInputElement>(null);\n\tconst blendInputRef = useRef<HTMLSelectElement>(null);\n\tconst colourInputRef = useRef<HTMLSelectElement>(null);\n\tconst contrastInputRef = useRef<HTMLInputElement>(null);\n\tconst brightnessInputRef = useRef<HTMLInputElement>(null);\n\n\tconst onInputChange = () => {\n\t\tconst newSettings: SettingsValues = {\n\t\t\twaveStyle: (waveInputRef.current?.value as keyof typeof waveStyles) ?? defaultSettings.waveStyle,\n\t\t\tblendMode: (blendInputRef.current?.value as keyof typeof blendModes) ?? defaultSettings.blendMode,\n\t\t\tcolourScheme: (colourInputRef.current?.value as keyof typeof colourLabels) ?? defaultSettings.colourScheme,\n\n\t\t\tverticalCenter:\n\t\t\t\tcenterInputRef.current?.value != null\n\t\t\t\t\t? Number.parseFloat(centerInputRef.current?.value)\n\t\t\t\t\t: defaultSettings.verticalCenter,\n\t\t\tmagnitude:\n\t\t\t\tmagnitudeInputRef.current?.value != null\n\t\t\t\t\t? Number.parseFloat(magnitudeInputRef.current?.value)\n\t\t\t\t\t: defaultSettings.verticalCenter,\n\t\t\tcontrast:\n\t\t\t\tcontrastInputRef.current?.value != null\n\t\t\t\t\t? Number.parseFloat(contrastInputRef.current?.value)\n\t\t\t\t\t: defaultSettings.contrast,\n\t\t\tbrightness:\n\t\t\t\tbrightnessInputRef.current?.value != null\n\t\t\t\t\t? Number.parseFloat(brightnessInputRef.current?.value)\n\t\t\t\t\t: defaultSettings.brightness,\n\t\t};\n\n\t\tprops.onSettingsChanged(newSettings);\n\t};\n\n\treturn (\n\t\t<div className='Settings SettingsContainer__Section'>\n\t\t\t<h2 className='Heading Heading--2'>2. Settings</h2>\n\t\t\t<label className='Settings__Label' htmlFor='wave-select'>\n\t\t\t\tWavey style\n\t\t\t</label>\n\t\t\t{/* eslint-disable-next-line jsx-a11y/no-onchange */}\n\t\t\t<select className='Settings__Input' id='wave-select' ref={waveInputRef} onChange={onInputChange}>\n\t\t\t\t{Object.keys(waveStyles).map((key) => (\n\t\t\t\t\t<option key={key} value={key}>\n\t\t\t\t\t\t{waveStyles[key as keyof typeof waveStyles]}\n\t\t\t\t\t</option>\n\t\t\t\t))}\n\t\t\t</select>\n\n\t\t\t<label className='Settings__Label' htmlFor='magnitude-slider'>\n\t\t\t\tParty magnitude\n\t\t\t</label>\n\t\t\t<input\n\t\t\t\tclassName='Settings__Input'\n\t\t\t\tid='magnitude-slider'\n\t\t\t\ttype='range'\n\t\t\t\tmin='0'\n\t\t\t\tmax='1.5'\n\t\t\t\tstep='0.05'\n\t\t\t\tref={magnitudeInputRef}\n\t\t\t\tdefaultValue={defaultSettings.magnitude}\n\t\t\t\tonChange={onInputChange}\n\t\t\t/>\n\n\t\t\t<label className='Settings__Label' htmlFor='center-slider'>\n\t\t\t\tVertical center\n\t\t\t</label>\n\t\t\t{/* TODO: sort out the scale transform so the min/max of this can be more logical numbers */}\n\t\t\t<input\n\t\t\t\tclassName='Settings__Input'\n\t\t\t\tid='center-slider'\n\t\t\t\ttype='range'\n\t\t\t\tmin='-0.65'\n\t\t\t\tmax='2'\n\t\t\t\tstep='0.05'\n\t\t\t\tref={centerInputRef}\n\t\t\t\tdefaultValue={defaultSettings.verticalCenter}\n\t\t\t\tonChange={onInputChange}\n\t\t\t/>\n\n\t\t\t<label className='Settings__Label' htmlFor='colour-select'>\n\t\t\t\tRainbow colours\n\t\t\t</label>\n\t\t\t{/* eslint-disable-next-line jsx-a11y/no-onchange */}\n\t\t\t<select className='Settings__Input' id='colour-select' ref={colourInputRef} onChange={onInputChange}>\n\t\t\t\t{Object.keys(colourOptions).map((key) => (\n\t\t\t\t\t<option key={key} value={key}>\n\t\t\t\t\t\t{colourOptions[key as keyof typeof colourOptions]}\n\t\t\t\t\t</option>\n\t\t\t\t))}\n\t\t\t</select>\n\n\t\t\t{colourInputRef.current?.value !== NONE_COLOUR_NAME && (\n\t\t\t\t<>\n\t\t\t\t\t<label className='Settings__Label' htmlFor='contrast-slider'>\n\t\t\t\t\t\tContrast\n\t\t\t\t\t</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\tclassName='Settings__Input'\n\t\t\t\t\t\tid='contrast-slider'\n\t\t\t\t\t\ttype='range'\n\t\t\t\t\t\tmin='-1'\n\t\t\t\t\t\tmax='1'\n\t\t\t\t\t\tstep='0.05'\n\t\t\t\t\t\tref={contrastInputRef}\n\t\t\t\t\t\tdefaultValue={defaultSettings.contrast}\n\t\t\t\t\t\tonChange={onInputChange}\n\t\t\t\t\t/>\n\n\t\t\t\t\t<label className='Settings__Label' htmlFor='brightness-slider'>\n\t\t\t\t\t\tBrightness\n\t\t\t\t\t</label>\n\t\t\t\t\t<input\n\t\t\t\t\t\tclassName='Settings__Input'\n\t\t\t\t\t\tid='brightness-slider'\n\t\t\t\t\t\ttype='range'\n\t\t\t\t\t\tmin='0'\n\t\t\t\t\t\tmax='2'\n\t\t\t\t\t\tstep='0.05'\n\t\t\t\t\t\tref={brightnessInputRef}\n\t\t\t\t\t\tdefaultValue={defaultSettings.brightness}\n\t\t\t\t\t\tonChange={onInputChange}\n\t\t\t\t\t/>\n\n\t\t\t\t\t<label className='Settings__Label' htmlFor='blend-select'>\n\t\t\t\t\t\tRainbow blend mode\n\t\t\t\t\t</label>\n\t\t\t\t\t{/* eslint-disable-next-line jsx-a11y/no-onchange */}\n\t\t\t\t\t<select className='Settings__Input' id='blend-select' ref={blendInputRef} onChange={onInputChange}>\n\t\t\t\t\t\t{Object.keys(blendModes).map((key) => (\n\t\t\t\t\t\t\t<option key={key} value={key}>\n\t\t\t\t\t\t\t\t{blendModes[key as keyof typeof blendModes]}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</select>\n\t\t\t\t</>\n\t\t\t)}\n\t\t</div>\n\t);\n}\n","import React, { useState, useEffect, useRef, useMemo, ChangeEvent } from 'react';\nimport FileSelector from './FileSelector';\nimport MessagePreview from './MessagePreview';\nimport Settings, { SettingsValues, defaultSettings, NONE_COLOUR_NAME } from './Settings';\nimport { frameCount, getTransformationMatrices, colours } from '../config/animation';\n\nconst maxWidth = 100;\nconst maxHeight = maxWidth;\nconst frameDuration = 50;\n\ninterface ImageMeta {\n\tloaded: boolean;\n\twidth: number;\n\theight: number;\n}\n\ninterface CropBounds {\n\ttop: number;\n\tleft: number;\n\tright: number;\n\tbottom: number;\n}\n\ninterface ImageSizing {\n\tcanvasWidth: number;\n\tcanvasHeight: number;\n\timageRegionWidth: number;\n\timageRegionHeight: number;\n}\n\ninterface CachedFrameData {\n\tframes: ImageData[];\n\tcrop: CropBounds;\n}\n\nexport type PreviewRenderListener = (canvas: HTMLCanvasElement, sourceWidth: number, sourceHight: number) => void;\n\n/**\n * Gets the bounds of the non-transparent image data.\n * Represented as distance from the top-left corner of the provided canvas.\n */\nfunction getPixelBoundsForCanvas(ctx: CanvasRenderingContext2D): CropBounds {\n\tconst width = ctx.canvas.width;\n\tconst height = ctx.canvas.height;\n\n\tconst pixels = ctx.getImageData(0, 0, width, height);\n\tconst pixelDataLength = pixels.data.length;\n\n\tconst bounds = {\n\t\ttop: height / 2,\n\t\tleft: width / 2,\n\t\tright: width / 2,\n\t\tbottom: height / 2,\n\t};\n\n\tlet x,\n\t\ty = 0;\n\n\t// Based on https://gist.github.com/remy/784508\n\tfor (let i = 0; i < pixelDataLength; i += 4) {\n\t\tif (pixels.data[i + 3] !== 0) {\n\t\t\tx = (i / 4) % width;\n\t\t\ty = ~~(i / 4 / width);\n\n\t\t\tif (y < bounds.top) {\n\t\t\t\tbounds.top = y;\n\t\t\t}\n\n\t\t\tif (x < bounds.left) {\n\t\t\t\tbounds.left = x;\n\t\t\t}\n\n\t\t\tif (x > bounds.right) {\n\t\t\t\tbounds.right = x;\n\t\t\t}\n\n\t\t\tif (y > bounds.bottom) {\n\t\t\t\tbounds.bottom = y;\n\t\t\t}\n\t\t}\n\t}\n\n\tbounds.bottom += 1;\n\tbounds.right += 1;\n\n\treturn bounds;\n}\n\nfunction getPixelBounds(image: CanvasImageSource): CropBounds {\n\tconst cropperCanvas = document.createElement('canvas');\n\tcropperCanvas.width = image.width as number;\n\tcropperCanvas.height = image.height as number;\n\n\tconst cropperCtx = cropperCanvas.getContext('2d');\n\n\tif (!cropperCtx) {\n\t\treturn {\n\t\t\ttop: 0,\n\t\t\tleft: 0,\n\t\t\tright: image.width as number,\n\t\t\tbottom: image.height as number,\n\t\t};\n\t}\n\n\tcropperCtx.drawImage(image, 0, 0);\n\tconst bounds = getPixelBoundsForCanvas(cropperCtx);\n\n\treturn bounds;\n}\n\n/**\n * Calculates info needed to size the output canvas, based on the provided image information\n */\nfunction getImageSizing(imageMeta: ImageMeta): ImageSizing {\n\tconst width = imageMeta.width;\n\tconst height = imageMeta.height;\n\n\tconst scaleAmount = Math.min(1, maxWidth / width, maxHeight / height);\n\n\tconst imageRegionWidth = width * scaleAmount;\n\tconst imageRegionHeight = height * scaleAmount;\n\n\treturn {\n\t\tcanvasWidth: maxWidth * 2, // These are hardcoded for the sake of keeping the transformation matrices simple and static\n\t\tcanvasHeight: maxHeight * 2,\n\t\timageRegionWidth,\n\t\timageRegionHeight,\n\t};\n}\n\n/**\n * Pre-renders static things that are used by the main render function.\n * @param imageSizing Sizing info to use to position the image\n * @param preProcessedImageCtx Canvas context where the pre-processed image will be drawn\n * @param image Image to draw\n */\nfunction prepForRender(\n\timageSizing: ImageSizing,\n\tpreProcessedImageCtx: CanvasRenderingContext2D,\n\timage: HTMLImageElement | HTMLCanvasElement,\n\tsettings: SettingsValues\n) {\n\tpreProcessedImageCtx.drawImage(\n\t\timage,\n\t\t0,\n\t\t0,\n\t\timage.width,\n\t\timage.height,\n\t\t(imageSizing.canvasWidth - imageSizing.imageRegionWidth) / 2,\n\t\t(imageSizing.canvasHeight - imageSizing.imageRegionHeight) / 2,\n\t\timageSizing.imageRegionWidth,\n\t\timageSizing.imageRegionHeight\n\t);\n\n\tif (settings.colourScheme !== NONE_COLOUR_NAME) {\n\t\t// Convert to grayscale\n\t\tconst grayscaleImage = preProcessedImageCtx.getImageData(0, 0, imageSizing.canvasWidth, imageSizing.canvasHeight);\n\t\tconst pixels = grayscaleImage.data;\n\n\t\tconst brightnessFactor = settings.brightness;\n\t\tconst contrast = settings.contrast * 254;\n\t\tconst contrastFactor = (255 + contrast) / (255 - contrast);\n\n\t\tfor (let i = 0; i < pixels.length; i += 4) {\n\t\t\tconst brightness = pixels[i] * 0.299 + pixels[i + 1] * 0.587 + pixels[i + 2] * 0.114;\n\t\t\tconst valueAdjusted = brightnessFactor * (contrastFactor * (brightness - 128) + 128);\n\n\t\t\tpixels[i] = valueAdjusted;\n\t\t\tpixels[i + 1] = valueAdjusted;\n\t\t\tpixels[i + 2] = valueAdjusted;\n\t\t}\n\n\t\tpreProcessedImageCtx.putImageData(grayscaleImage, 0, 0);\n\t}\n}\n\n/**\n * Renders all frames of the animation and returns them as ImageData, along with info on how the final frames should be cropped\n */\nfunction generateCachedFrames(\n\tsettings: SettingsValues,\n\timageSizing: ImageSizing,\n\timage: CanvasImageSource\n): CachedFrameData | null {\n\tconst canvas = document.createElement('canvas');\n\tconst ctx = canvas.getContext('2d');\n\n\tif (!ctx) {\n\t\treturn null;\n\t}\n\n\tconst cachedFrames = [];\n\n\tcanvas.width = imageSizing.canvasWidth;\n\tcanvas.height = imageSizing.canvasHeight;\n\n\tconst maximalBounds = {\n\t\ttop: canvas.height,\n\t\tleft: canvas.width,\n\t\tright: 0,\n\t\tbottom: 0,\n\t};\n\n\tconst transformationMatrices = getTransformationMatrices(\n\t\tsettings.waveStyle,\n\t\tsettings.verticalCenter,\n\t\tsettings.magnitude\n\t);\n\n\tfor (let i = 0; i < frameCount; i++) {\n\t\trenderFrame(i, ctx, image, imageSizing, settings, transformationMatrices);\n\t\tconst rawData = ctx.getImageData(0, 0, imageSizing.canvasWidth, imageSizing.canvasHeight);\n\t\tconst rawPixels = rawData.data;\n\n\t\t// Hack to deal with the GIF encoder needing a key colour to make transparent. Without this, black (which we\n\t\t// specify as the key colour) would become transparent. So this here replaces solid black with slightly-off-black\n\t\tfor (let pixelIndex = 0; pixelIndex < rawPixels.length; pixelIndex += 4) {\n\t\t\tif (\n\t\t\t\trawPixels[pixelIndex] === 0 &&\n\t\t\t\trawPixels[pixelIndex + 1] === 0 &&\n\t\t\t\trawPixels[pixelIndex + 2] === 0 &&\n\t\t\t\trawPixels[pixelIndex + 3] !== 0\n\t\t\t) {\n\t\t\t\trawPixels[pixelIndex] = 1;\n\t\t\t\trawPixels[pixelIndex + 1] = 1;\n\t\t\t\trawPixels[pixelIndex + 2] = 1;\n\t\t\t}\n\t\t}\n\n\t\tcachedFrames.push(rawData);\n\n\t\tconst computedBounds = getPixelBounds(canvas);\n\n\t\tmaximalBounds.top = Math.min(computedBounds.top, maximalBounds.top);\n\t\tmaximalBounds.left = Math.min(computedBounds.left, maximalBounds.left);\n\t\tmaximalBounds.right = Math.max(computedBounds.right, maximalBounds.right);\n\t\tmaximalBounds.bottom = Math.max(computedBounds.bottom, maximalBounds.bottom);\n\t}\n\n\treturn { frames: cachedFrames, crop: maximalBounds };\n}\n\nfunction renderFrame(\n\tframeNumber: number,\n\tcanvasCtx: CanvasRenderingContext2D,\n\timageSource: CanvasImageSource,\n\timageSizing: ImageSizing,\n\tsettings: SettingsValues,\n\ttransformationMatrices: number[][]\n) {\n\tconst frameTransformation = transformationMatrices[frameNumber % transformationMatrices.length] ?? [];\n\tcanvasCtx.globalCompositeOperation = 'source-over';\n\tcanvasCtx.clearRect(0, 0, imageSizing.canvasWidth, imageSizing.canvasHeight);\n\n\tcanvasCtx.setTransform(...(frameTransformation as DOMMatrix2DInit[]));\n\t// draw base image\n\tcanvasCtx.globalCompositeOperation = 'source-over';\n\tcanvasCtx.drawImage(imageSource, 0, 0);\n\n\t// overlay the colour blend\n\tif (settings.colourScheme in colours) {\n\t\tcanvasCtx.globalCompositeOperation = settings.blendMode;\n\t\tcanvasCtx.fillStyle = colours[settings.colourScheme as keyof typeof colours][frameNumber];\n\t\tcanvasCtx.fillRect(0, 0, imageSizing.canvasWidth, imageSizing.canvasHeight);\n\t}\n\n\t// mask using the original image\n\tcanvasCtx.globalCompositeOperation = 'destination-in';\n\tcanvasCtx.drawImage(imageSource, 0, 0);\n}\n\nfunction renderCachedFrame(canvasCtx: CanvasRenderingContext2D, cachedFrame: ImageData, crop: CropBounds) {\n\tcanvasCtx.putImageData(cachedFrame, -crop.left, -crop.top);\n}\n\nexport default function Creator(): JSX.Element {\n\tconst [settings, setSettings] = useState<SettingsValues>({\n\t\t...defaultSettings,\n\t});\n\n\tconst [imageElement] = useState<HTMLImageElement>(new Image());\n\tconst [imageSource, setImageSource] = useState<HTMLImageElement | HTMLCanvasElement | null>(null);\n\tconst [emojiCanvas] = useState<HTMLCanvasElement>(() => {\n\t\tconst canvas = document.createElement('canvas');\n\t\tcanvas.width = 200;\n\t\tcanvas.height = 200;\n\n\t\treturn canvas;\n\t});\n\tconst [imagePrepCanvas] = useState<HTMLCanvasElement>(document.createElement('canvas'));\n\tconst [imageMeta, setImageMeta] = useState<ImageMeta>({ loaded: false, width: 0, height: 0 });\n\tconst [lastRenderIteration, setLastRenderIteration] = useState(0);\n\tconst [lastRenderTime, setLastRenderTime] = useState(0);\n\tconst [outputImageBlobUrl, setOutputImageBlobUrl] = useState<string | null>(null);\n\tconst [previewRenderListeners, setPreviewRenderListeners] = useState<PreviewRenderListener[]>([]);\n\tconst [cachedFrameData, setCachedFrameData] = useState<CachedFrameData | null>();\n\n\tconst previewCanvasRef = useRef<HTMLCanvasElement>(null);\n\tconst outputElementRef = useRef<HTMLDivElement>(null);\n\tconst emojiInputRef = useRef<HTMLInputElement>(null);\n\n\tconst onFileSelected = (file: File | undefined) => {\n\t\timageElement.src = URL.createObjectURL(file);\n\n\t\tif (emojiInputRef.current) {\n\t\t\temojiInputRef.current.value = '';\n\t\t}\n\n\t\timageElement.onload = () => {\n\t\t\tsetImageMeta({\n\t\t\t\tloaded: true,\n\t\t\t\twidth: imageElement.width,\n\t\t\t\theight: imageElement.height,\n\t\t\t});\n\n\t\t\tsetImageSource(imageElement);\n\t\t};\n\n\t\t// Clear the existing output, to avoid confusion\n\t\tsetOutputImageBlobUrl(null);\n\t};\n\n\tconst onTextEntered = (event: ChangeEvent) => {\n\t\tconst ctx = emojiCanvas.getContext('2d');\n\t\tconst value = (event.target as HTMLInputElement).value;\n\n\t\tif (!ctx || value.trim().length <= 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tctx.clearRect(0, 0, emojiCanvas.width, emojiCanvas.height);\n\t\tctx.font = 'bold 100px sans-serif';\n\t\tctx.fillText(value, emojiCanvas.width / 2, emojiCanvas.height / 2);\n\n\t\tsetImageMeta({\n\t\t\tloaded: true,\n\t\t\twidth: emojiCanvas.width,\n\t\t\theight: emojiCanvas.height,\n\t\t});\n\n\t\tsetImageSource(emojiCanvas);\n\n\t\t// Clear the existing output, to avoid confusion\n\t\tsetOutputImageBlobUrl(null);\n\t};\n\n\t// TODO: Bit of a hackish way to notify the message preview when there's a new frame to render, leftover from an earlier approach\n\t// The more React-y way would be to pass the cached image data in\n\tconst addPreviewRenderListener = useMemo(() => {\n\t\treturn (listener: PreviewRenderListener) => {\n\t\t\tsetPreviewRenderListeners((state) => {\n\t\t\t\treturn [...state, listener];\n\t\t\t});\n\t\t};\n\t}, []);\n\n\tconst removePreviewRenderListener = useMemo(() => {\n\t\treturn (listener: PreviewRenderListener) => {\n\t\t\tsetPreviewRenderListeners((state) => {\n\t\t\t\treturn state.filter((l) => l !== listener);\n\t\t\t});\n\t\t};\n\t}, []);\n\n\tuseEffect(() => {\n\t\tconst imagePrepCtx = imagePrepCanvas.getContext('2d');\n\n\t\tconst previewCanvas = previewCanvasRef.current;\n\t\tconst previewCanvasCtx = previewCanvas?.getContext('2d');\n\n\t\tif (!imageSource || !imagePrepCtx || !previewCanvas || !previewCanvasCtx) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst imageSizing = getImageSizing(imageMeta);\n\n\t\tconst canvasWidth = imageSizing.canvasWidth;\n\t\tconst canvasHeight = imageSizing.canvasHeight;\n\n\t\timagePrepCanvas.width = canvasWidth;\n\t\timagePrepCanvas.height = canvasHeight;\n\n\t\tprepForRender(imageSizing, imagePrepCtx, imageSource, settings);\n\t\tconst cachedData = generateCachedFrames(settings, imageSizing, imagePrepCanvas);\n\t\tsetCachedFrameData(cachedData);\n\n\t\tif (!cachedData) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst previewWidth = (previewCanvas.width = cachedData.crop.right - cachedData.crop.left);\n\t\tconst previewHeight = (previewCanvas.height = cachedData.crop.bottom - cachedData.crop.top);\n\n\t\tlet updateLoopRef: number | undefined;\n\t\tlet renderIteration = lastRenderIteration;\n\t\tlet lastUpdatedAt = lastRenderTime || performance.now();\n\t\tlet lastLoopedAt = lastUpdatedAt;\n\n\t\tconst updateLoop = () => {\n\t\t\tconst now = performance.now();\n\t\t\tconst timeDiff = now - lastUpdatedAt;\n\t\t\tconst timeSinceLastLoop = now - lastLoopedAt;\n\n\t\t\t// Add half the time since the last RAF call, to smooth out / factor for the next update potentially being further from the frame duration than this one\n\t\t\tconst elapsedFrames = Math.floor((timeDiff + timeSinceLastLoop / 2) / frameDuration);\n\t\t\trenderIteration = (renderIteration + elapsedFrames) % frameCount;\n\t\t\tlastLoopedAt = now;\n\n\t\t\tif (elapsedFrames > 0) {\n\t\t\t\tlastUpdatedAt = now;\n\t\t\t\trenderCachedFrame(previewCanvasCtx, cachedData.frames[renderIteration], cachedData.crop);\n\n\t\t\t\tpreviewRenderListeners.forEach((listener) => {\n\t\t\t\t\tlistener(previewCanvas, previewWidth, previewHeight);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tupdateLoopRef = window.requestAnimationFrame(updateLoop);\n\t\t};\n\n\t\tupdateLoop();\n\n\t\treturn () => {\n\t\t\tif (updateLoopRef) {\n\t\t\t\twindow.cancelAnimationFrame(updateLoopRef);\n\n\t\t\t\t// Remember where in the loop we were for less janky updates while changing settings\n\t\t\t\t// TODO: This barely works / still looks pretty bad\n\t\t\t\tsetLastRenderIteration(renderIteration);\n\t\t\t\tsetLastRenderTime(lastUpdatedAt);\n\t\t\t}\n\t\t};\n\t}, [imageSource, imageMeta, settings]);\n\n\tconst generateGif = () => {\n\t\tif (!cachedFrameData || !window.GIF) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst gifOutputCanvas = document.createElement('canvas');\n\n\t\tconst width = (gifOutputCanvas.width = cachedFrameData.crop.right - cachedFrameData.crop.left);\n\t\tconst height = (gifOutputCanvas.height = cachedFrameData.crop.bottom - cachedFrameData.crop.top);\n\n\t\tconst outputProcessingCtx = gifOutputCanvas.getContext('2d');\n\t\tif (!outputProcessingCtx) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst gifRenderer = new window.GIF({\n\t\t\tworkers: 4,\n\t\t\tworkerScript: `${process.env.PUBLIC_URL}/vendor/gifjs/gif.worker.js`,\n\t\t\twidth,\n\t\t\theight,\n\t\t\ttransparent: 0x00000000,\n\t\t});\n\n\t\tgifRenderer.on('finished', (blob: Blob) => {\n\t\t\tsetOutputImageBlobUrl(URL.createObjectURL(blob));\n\t\t});\n\n\t\tfor (let frameNumber = 0; frameNumber < frameCount; frameNumber++) {\n\t\t\trenderCachedFrame(outputProcessingCtx, cachedFrameData.frames[frameNumber], cachedFrameData.crop);\n\t\t\tgifRenderer.addFrame(outputProcessingCtx, { delay: 50, copy: true });\n\t\t}\n\n\t\tgifRenderer.render();\n\n\t\toutputElementRef.current?.scrollIntoView();\n\t};\n\n\treturn (\n\t\t<section className='Creator'>\n\t\t\t<FileSelector onFileSelected={onFileSelected} />\n\n\t\t\t<div className='EmojiInput'>\n\t\t\t\t<label htmlFor='emoji-input' className='EmojiInput__Label'>\n\t\t\t\t\tOr type an emoji <span className='EmojiInput__LabelHelp'>(ctrl+cmd+space on Mac)</span>\n\t\t\t\t</label>\n\t\t\t\t<input\n\t\t\t\t\tclassName='EmojiInput__Input'\n\t\t\t\t\tid='emoji-input'\n\t\t\t\t\ttype='text'\n\t\t\t\t\tmaxLength={4}\n\t\t\t\t\tonChange={onTextEntered}\n\t\t\t\t\tplaceholder='😄'\n\t\t\t\t/>\n\t\t\t</div>\n\n\t\t\t<div className='SettingsContainer'>\n\t\t\t\t<Settings onSettingsChanged={setSettings} />\n\t\t\t\t<div className='SettingsContainer__Section SettingsContainer__Section--secondary PreviewSection'>\n\t\t\t\t\t<div className='PreviewSection__Big'>\n\t\t\t\t\t\t<canvas ref={previewCanvasRef} />\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<MessagePreview onReady={addPreviewRenderListener} onDestroy={removePreviewRenderListener} />\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<button type='button' className='Button' onClick={generateGif}>\n\t\t\t\tGenerate GIF\n\t\t\t</button>\n\n\t\t\t<div className='Output' ref={outputElementRef}>\n\t\t\t\t{outputImageBlobUrl && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<p>Right click / long-press on the image below, choose save, and get the party started!</p>\n\t\t\t\t\t\t<img className='Output__Image' alt='' src={outputImageBlobUrl} />\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\tPlease be considerate of others when using any images from here, particularly on platforms with no option\n\t\t\t\t\t\t\tto disable animated emoji.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</section>\n\t);\n}\n","import React from 'react';\nimport FocusLock from 'react-focus-lock';\n\ninterface ModalChildProps {\n\ttriggerClose: () => void;\n}\n\ninterface ModalProps {\n\tchildren: (props: ModalChildProps) => React.ReactNode;\n\tisOpen: boolean;\n\tonClose: () => void;\n}\nexport default function Modal(props: ModalProps): JSX.Element | null {\n\tif (!props.isOpen) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<FocusLock>\n\t\t\t<div className='Modal__Background'>\n\t\t\t\t<div className='Modal' role='dialog' aria-modal='true'>\n\t\t\t\t\t{props.children({ triggerClose: props.onClose })}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</FocusLock>\n\t);\n}\n","import { useState } from 'react';\n\nfunction makeKey(key: string) {\n\treturn `partify:${key}`;\n}\n\nexport function useLocalStorage<T>(key: string, initialValue: T): [T, (value: T) => void] {\n\tconst [storedValue, setStoredValue] = useState<T>(() => {\n\t\ttry {\n\t\t\tconst item = window.localStorage.getItem(makeKey(key));\n\n\t\t\treturn item ? JSON.parse(item) : initialValue;\n\t\t} catch (error) {\n\t\t\treturn initialValue;\n\t\t}\n\t});\n\n\tconst setValue = (value: T) => {\n\t\ttry {\n\t\t\tsetStoredValue(value);\n\t\t\twindow.localStorage.setItem(makeKey(key), JSON.stringify(value));\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t}\n\t};\n\n\treturn [storedValue, setValue];\n}\n","import React from 'react';\nexport default function Footer(): JSX.Element {\n\treturn (\n\t\t<footer className='Footer'>\n\t\t\t<p className='Footer__Paragraph'>\n\t\t\t\t* None of this is true. not associated with Slack, can bring the party anywhere that supports custom emoji (MS\n\t\t\t\tTeams, you make it hard to love you). Inspired by{' '}\n\t\t\t\t<a href='https://cultofthepartyparrot.com/'>Cult of the Party Parrot</a>\n\t\t\t</p>\n\t\t\t<p className='Footer__Paragraph'>\n\t\t\t\tmade with <img src={`${process.env.PUBLIC_URL}/heart.gif`} alt='love' className='Footer__Icon' /> by{' '}\n\t\t\t\t<a href='https://twitter.com/Nathanielnw'>Nate Watson</a>\n\t\t\t</p>\n\t\t\t<p className='Footer__Paragraph'>\n\t\t\t\t<a href='https://github.com/nathanielw/party-ify'>Source on GitHub</a>\n\t\t\t</p>\n\t\t</footer>\n\t);\n}\n","import React, { useState } from 'react';\nimport './styles/styles.scss';\nimport Intro from './components/Intro';\nimport Creator from './components/Creator';\nimport Modal from './components/Modal';\nimport { useLocalStorage } from './util/useLocalStorage';\nimport Footer from './components/Footer';\n\nexport default function App(): JSX.Element {\n\tconst [hasSeenModal, setHasSeenModal] = useLocalStorage<boolean>('hasSeenModal', false);\n\tconst [isModalOpen, setIsModalOpen] = useState<boolean>(!hasSeenModal);\n\n\tconst handleModalClose = () => {\n\t\tsetIsModalOpen(false);\n\t\tsetHasSeenModal(true);\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<main\n\t\t\t\taria-hidden={isModalOpen ? 'true' : undefined}\n\t\t\t\tclassName={`App__Main ${isModalOpen ? 'App__Main--modalOpen' : ''}`}\n\t\t\t>\n\t\t\t\t<Intro />\n\n\t\t\t\t<Creator />\n\n\t\t\t\t<Footer />\n\t\t\t</main>\n\n\t\t\t<Modal onClose={handleModalClose} isOpen={isModalOpen}>\n\t\t\t\t{({ triggerClose }) => (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<p className='Modal__Text'>Hello! this site contains animations with flashing colours.</p>\n\t\t\t\t\t\t<button className='Button Button--secondary' type='button' onClick={triggerClose}>\n\t\t\t\t\t\t\tOK, let me in\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</Modal>\n\t\t</>\n\t);\n}\n","import * as React from 'react';\nimport { render } from 'react-dom';\n\nimport App from './App';\n\nconst rootElement = document.getElementById('appcontainer');\nrender(<App />, rootElement);\n"],"sourceRoot":""}